# ModSecurity Exclusion Rules for Bootstrap Icons
# This file should be included in your ModSecurity configuration
# to allow Bootstrap Icons font files to load properly.
#
# IMPORTANT: This file must be included BEFORE the CRS rules
# In modsecurity.conf, add this line BEFORE the CRS includes:
# Include /etc/nginx/modsecurity/bootstrap-icons-exclusion.conf

# Allow Bootstrap Icons font files
# Bootstrap Icons uses font files (woff2, woff, ttf, eot) that might be flagged by CRS rules
# These rules disable blocking for legitimate font file requests

# Rule 1: Exclude font files by file extension in the URL
# Matches: /static/app/dist/assets/anything.woff2, .woff, .ttf, .eot, .svg
SecRule REQUEST_URI "@rx \.(woff2?|ttf|eot|otf|svg)(\?|$)" \
    "id:1000001,\
    phase:1,\
    t:none,\
    t:lowercase,\
    pass,\
    nolog,\
    ctl:ruleRemoveById=941000,\
    ctl:ruleRemoveById=942000,\
    ctl:ruleRemoveById=943000,\
    ctl:ruleRemoveById=944000,\
    ctl:ruleRemoveById=949000,\
    ctl:ruleRemoveById=950000,\
    ctl:ruleRemoveById=951000,\
    ctl:ruleRemoveById=953000,\
    ctl:ruleRemoveById=954000,\
    ctl:ruleRemoveById=960000,\
    ctl:ruleRemoveById=970000,\
    ctl:ruleRemoveById=980000,\
    ctl:ruleRemoveById=990000,\
    ctl:ruleRemoveByTag=attack-sqli,\
    ctl:ruleRemoveByTag=attack-xss,\
    ctl:ruleRemoveByTag=attack-rfi,\
    ctl:ruleRemoveByTag=attack-injection,\
    msg:'Bootstrap Icons font file exclusion - by extension'"

# Rule 2: Exclude Bootstrap Icons CSS file
# Matches the CSS file that loads the fonts
SecRule REQUEST_URI "@rx bootstrap-icons.*\.css(\?|$)" \
    "id:1000002,\
    phase:1,\
    t:none,\
    t:lowercase,\
    pass,\
    nolog,\
    ctl:ruleRemoveById=942000,\
    ctl:ruleRemoveById=943000,\
    ctl:ruleRemoveById=949000,\
    ctl:ruleRemoveByTag=attack-xss,\
    ctl:ruleRemoveByTag=attack-injection,\
    msg:'Bootstrap Icons CSS file exclusion'"

# Rule 3: Exclude all static assets in the dist directory
# This is a more permissive rule for all built assets
# This should catch any font files in the assets directory
# We disable all CRS rules for static assets since they're just files being served
SecRule REQUEST_URI "@beginsWith /static/app/dist/" \
    "id:1000003,\
    phase:1,\
    t:none,\
    pass,\
    nolog,\
    ctl:ruleRemoveById=930000,\
    ctl:ruleRemoveById=931000,\
    ctl:ruleRemoveById=932000,\
    ctl:ruleRemoveById=933000,\
    ctl:ruleRemoveById=934000,\
    ctl:ruleRemoveById=941000,\
    ctl:ruleRemoveById=942000,\
    ctl:ruleRemoveById=943000,\
    ctl:ruleRemoveById=944000,\
    ctl:ruleRemoveById=949000,\
    ctl:ruleRemoveById=950000,\
    ctl:ruleRemoveById=951000,\
    ctl:ruleRemoveById=952000,\
    ctl:ruleRemoveById=953000,\
    ctl:ruleRemoveById=954000,\
    ctl:ruleRemoveById=960000,\
    ctl:ruleRemoveById=970000,\
    ctl:ruleRemoveById=980000,\
    ctl:ruleRemoveById=990000,\
    ctl:ruleRemoveByTag=OWASP_CRS,\
    ctl:ruleRemoveByTag=attack-sqli,\
    ctl:ruleRemoveByTag=attack-xss,\
    ctl:ruleRemoveByTag=attack-rfi,\
    ctl:ruleRemoveByTag=attack-lfi,\
    ctl:ruleRemoveByTag=attack-rce,\
    ctl:ruleRemoveByTag=attack-injection,\
    msg:'Static asset exclusion - dist directory (comprehensive)'"

# Rule 4: Exclude based on Accept header for font MIME types
# Some browsers send specific Accept headers for fonts
SecRule REQUEST_HEADERS:Accept "@rx font/(woff|woff2|ttf|eot|otf|svg)" \
    "id:1000004,\
    phase:1,\
    t:none,\
    t:lowercase,\
    pass,\
    nolog,\
    ctl:ruleRemoveById=942000,\
    ctl:ruleRemoveById=943000,\
    ctl:ruleRemoveById=949000,\
    ctl:ruleRemoveByTag=attack-xss,\
    ctl:ruleRemoveByTag=attack-injection,\
    msg:'Font MIME type exclusion - by Accept header'"

# Rule 5: Catch-all for any assets directory requests
# This catches font files in any assets subdirectory
SecRule REQUEST_URI "@rx /static/app/dist/.*assets.*\.(woff2?|ttf|eot|otf|svg|css|js)(\?|$)" \
    "id:1000005,\
    phase:1,\
    t:none,\
    t:lowercase,\
    pass,\
    nolog,\
    ctl:ruleRemoveById=930000,\
    ctl:ruleRemoveById=931000,\
    ctl:ruleRemoveById=932000,\
    ctl:ruleRemoveById=933000,\
    ctl:ruleRemoveById=934000,\
    ctl:ruleRemoveById=941000,\
    ctl:ruleRemoveById=942000,\
    ctl:ruleRemoveById=943000,\
    ctl:ruleRemoveById=944000,\
    ctl:ruleRemoveById=949000,\
    ctl:ruleRemoveById=950000,\
    ctl:ruleRemoveById=951000,\
    ctl:ruleRemoveById=952000,\
    ctl:ruleRemoveById=953000,\
    ctl:ruleRemoveById=954000,\
    ctl:ruleRemoveById=960000,\
    ctl:ruleRemoveById=970000,\
    ctl:ruleRemoveById=980000,\
    ctl:ruleRemoveById=990000,\
    ctl:ruleRemoveByTag=OWASP_CRS,\
    msg:'Assets directory exclusion - catch-all for built files'"

