apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- namespace.yaml
# PostgreSQL (Shared Database)
- postgres-configmap.yaml
- postgres-secret.yaml
- postgres-deployment.yaml
# Redis (Distributed Caching)
- redis-cluster-statefulset.yaml
- redis-secret.yaml
# WireGate (Clustered Application)
- wiregate-configmap.yaml
- wiregate-secret.yaml
- wiregate-serviceaccount.yaml
- wiregate-cluster-deployment.yaml
# Load Balancer
- nginx-loadbalancer.yaml
# Supporting Services
- dnscrypt-configmap.yaml
- tor-configmap.yaml
- ssl-configmap.yaml
- network-policy.yaml

commonLabels:
  app.kubernetes.io/name: wiregate
  app.kubernetes.io/version: "1.0.0"
  app.kubernetes.io/component: vpn-gateway-cluster

namespace: wiregate

# Patches for cluster configuration
patchesStrategicMerge:
- |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: wiregate-cluster
    namespace: wiregate
  spec:
    replicas: 5  # Override default replicas for cluster
